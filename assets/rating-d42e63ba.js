import{r as n,j as e}from"./index-b41d15ee.js";import{P as D,C as I,a as _,b as z,T as q,S as c}from"./sweetalert2.esm.all-403a7e4f.js";import{a as f}from"./axios-19f2ad51.js";const u=[{name:"Talent",description:"Skill level, technique, and overall performance quality",points:30},{name:"Creativity",description:"Originality of the act, unique ideas, and innovative approach",points:20},{name:"Stage Presence",description:"Confidence, charisma, and ability to engage the audience",points:20},{name:"Relevance of ICT",description:"Effective integration of ICT in the performance",points:15},{name:"Time Adherence",description:"Staying within the 2-3 minute time limit",points:15}];function O(){const[d,w]=n.useState([]),[v,m]=n.useState(!1),[U,S]=n.useState(""),[o,h]=n.useState(null),[i,b]=n.useState([0,0,0,0,0]),[k,C]=n.useState(new Map),[x,j]=n.useState(null),[y,R]=n.useState(null),E=n.useMemo(()=>Array.from({length:100},(s,t)=>({id:t,left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,delay:`${Math.random()*2}s`,size:`${1+Math.random()*2}px`})),[]);n.useEffect(()=>{P()},[]);const P=async()=>{try{m(!0);const s=await f.get("/api/v1/rate/performers/");w(Array.isArray(s.data)?s.data:[]),Array.isArray(s.data)&&s.data.forEach(t=>{N(t.id)})}catch(s){S("Failed to fetch performers"),console.error(s)}finally{m(!1)}},N=async s=>{try{const t=await f.get(`/api/v1/rate/performer-scores/${s}/`);C(a=>new Map(a).set(s,t.data))}catch(t){console.error(`Failed to fetch scores for performer ${s}`,t)}},T=(s,t)=>{const a=u[s].points;if(t<=a&&t>=0){const r=[...i];r[s]=t,b(r)}},B=async s=>{var a,r,l,g;s.preventDefault();const t=localStorage.getItem("voterName");if(!o||!t){c.fire({icon:"error",title:"Error!",text:"Please select a performer and ensure you have a voter name set",confirmButtonColor:"#040b35",background:"#0a1535",color:"#ffffff"});return}m(!0);try{const p={performer_id:o.id,rater:t,ratings:i};x?(await f.put(`/api/v1/rate/ratings/${x}/`,{performer:o.id,rater:t,ratings:i}),c.fire({icon:"success",title:"Updated!",text:"Rating updated successfully!",confirmButtonColor:"#040b35",background:"#0a1535",color:"#ffffff"}),j(null)):(await f.post("/api/v1/rate/submit-rating/",p),c.fire({icon:"success",title:"Submitted!",text:"Rating submitted successfully!",confirmButtonColor:"#040b35",background:"#0a1535",color:"#ffffff"})),await N(o.id),b([0,0,0,0,0]),h(null)}catch(p){const F=((r=(a=p.response)==null?void 0:a.data)==null?void 0:r.detail)||((g=(l=p.response)==null?void 0:l.data)==null?void 0:g.message)||"Failed to submit rating";c.fire({icon:"error",title:"Error!",text:F,confirmButtonColor:"#040b35",background:"#0a1535",color:"#ffffff"}),console.error("Error details:",p)}finally{m(!1)}},M=s=>{const t=d.find(a=>a.id===s.performer);h(t||null),b(s.ratings),j(s.id)},A=async s=>{var a,r;if((await c.fire({title:"Are you sure?",text:"You will not be able to recover this rating!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#040b35",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",background:"#0a1535",color:"#ffffff"})).isConfirmed){m(!0);try{await f.delete(`/api/v1/rate/ratings/${s}/`),d.forEach(l=>N(l.id)),c.fire({icon:"success",title:"Deleted!",text:"Rating deleted successfully!",confirmButtonColor:"#040b35",background:"#0a1535",color:"#ffffff"})}catch(l){const g=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to delete rating";c.fire({icon:"error",title:"Error!",text:g,confirmButtonColor:"#040b35",background:"#0a1535",color:"#ffffff"}),console.error(l)}finally{m(!1)}}},$=i.reduce((s,t)=>s+t,0);return e.jsxs("div",{className:"relative min-h-screen pt-5 pb-10 w-screen overflow-hidden flex items-center justify-center p-0 bg-transparent",children:[e.jsx("div",{className:"z-0 absolute w-full h-full pointer-events-none",children:e.jsx("div",{className:"stars-container",children:E.map(s=>e.jsx("div",{className:"star",style:{left:s.left,top:s.top,animationDelay:s.delay,width:s.size,height:s.size}},s.id))})}),e.jsxs("div",{className:"w-screen overflow-hidden relative z-10",children:[e.jsxs("div",{className:"text-center mb-8 px-4",children:[e.jsx("h1",{className:"text-4xl sm:text-3xl text-[#ffcc75] font-extrabold mb-2",children:"ðŸŽ­ Performance Rating"}),e.jsx("p",{className:"text-blue-200 text-base sm:text-lg",children:"Score performers based on 5 criteria"})]}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 space-y-8",children:[e.jsxs("div",{className:"p-4 sm:p-6 rounded-2xl",style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",backdropFilter:"blur(20px)"},children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-blue-300 mb-4",children:"ðŸ“‹ Scoring Matrix"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm sm:text-base",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-blue-300/30",children:[e.jsx("th",{className:"text-left p-2 sm:p-3 text-blue-200",children:"Criteria"}),e.jsx("th",{className:"text-left p-2 sm:p-3 text-blue-200",children:"Description"}),e.jsx("th",{className:"text-right p-2 sm:p-3 text-blue-200",children:"Points"})]})}),e.jsxs("tbody",{children:[u.map((s,t)=>e.jsxs("tr",{className:"border-b border-blue-300/20 hover:bg-blue-500/10",children:[e.jsx("td",{className:"p-2 sm:p-3 text-white font-semibold",children:s.name}),e.jsx("td",{className:"p-2 sm:p-3 text-gray-300 text-xs sm:text-sm",children:s.description}),e.jsx("td",{className:"text-right p-2 sm:p-3 text-yellow-300 font-bold",children:s.points})]},t)),e.jsxs("tr",{className:"bg-blue-500/10",children:[e.jsx("td",{colSpan:2,className:"p-2 sm:p-3 text-white font-bold",children:"Total"}),e.jsx("td",{className:"text-right p-2 sm:p-3 text-yellow-300 font-bold text-lg",children:"100"})]})]})]})})]}),e.jsxs("div",{className:"p-4 sm:p-6 rounded-2xl",style:{background:"rgba(147, 51, 234, 0.1)",border:"1px solid rgba(147, 51, 234, 0.3)",backdropFilter:"blur(20px)"},children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-purple-300 mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"w-6 h-6"}),x?"Edit Rating":"Submit Rating"]}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-purple-200 mb-2",children:"Select Performer *"}),e.jsxs("select",{value:(o==null?void 0:o.id)||"",onChange:s=>{const t=d.find(a=>a.id===parseInt(s.target.value));h(t||null)},required:!0,className:"w-full px-4 py-2 bg-black/30 border border-purple-300/30 rounded-lg text-white focus:outline-none focus:border-purple-400",children:[e.jsx("option",{value:"",children:"Choose a performer..."}),d.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"space-y-3 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-300 mb-3",children:"Rating Scores"}),u.map((s,t)=>e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 border border-purple-300/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:s.name}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-400",children:s.description})]}),e.jsxs("p",{className:"text-sm text-purple-300 font-semibold",children:["Max: ",s.points]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",min:"0",max:s.points,value:i[t],onChange:a=>T(t,parseInt(a.target.value)||0),className:"w-20 px-3 py-2 bg-black/30 border border-purple-300/30 rounded-lg text-white focus:outline-none focus:border-purple-400"}),e.jsx("div",{className:"flex-1 h-2 bg-purple-300/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all",style:{width:`${i[t]/s.points*100}%`}})}),e.jsxs("span",{className:"text-sm text-purple-300 font-semibold",children:[i[t],"/",s.points]})]})]},t))]}),e.jsx("div",{className:"p-4 rounded-lg bg-purple-500/20 border border-purple-300/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-bold text-purple-300",children:"Total Score"}),e.jsxs("span",{className:"text-3xl font-bold text-yellow-300",children:[$,"/100"]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:v,className:"flex-1 px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-700 transition-all disabled:opacity-50",children:v?"Submitting...":x?"Update Rating":"Submit Rating"}),x&&e.jsx("button",{type:"button",onClick:()=>{b([0,0,0,0,0]),h(null),j(null)},className:"flex-1 px-6 py-2 bg-gray-600 rounded-lg font-semibold hover:bg-gray-700 transition-all",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#ffcc75]",children:"ðŸ“Š Performance Scores"}),d.length===0?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"No performers yet"}):d.map(s=>{const t=k.get(s.id);return e.jsxs("div",{className:"p-4 rounded-2xl",style:{background:"rgba(100, 150, 255, 0.1)",border:"1px solid rgba(100, 200, 255, 0.3)",backdropFilter:"blur(20px)"},children:[e.jsxs("button",{onClick:()=>R(y===s.id?null:s.id),className:"w-full flex items-center justify-between text-lg font-bold text-cyan-300 hover:text-cyan-200 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:`https://zipfile.pythonanywhere.com${s.photo}`,alt:s.name,className:"w-12 h-12 rounded-lg object-cover"}),e.jsx("span",{children:s.name})]}),y===s.id?e.jsx(I,{className:"w-5 h-5"}):e.jsx(_,{className:"w-5 h-5"})]}),y===s.id&&t&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-black/20",children:[e.jsx("h4",{className:"text-cyan-300 font-semibold mb-3",children:"Average Scores"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[u.map((a,r)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-300",children:a.name}),e.jsx("span",{className:"text-cyan-300 font-semibold",children:t.average_scores[a.name]})]},r)),e.jsxs("div",{className:"col-span-1 sm:col-span-2 pt-2 border-t border-cyan-300/20 flex justify-between font-bold",children:[e.jsx("span",{className:"text-cyan-300",children:"Average Total"}),e.jsxs("span",{className:"text-yellow-300 text-lg",children:[t.average_scores.average_total.toFixed(1),"/100"]})]})]})]}),t.ratings.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-cyan-300 font-semibold",children:["Judge Ratings (",t.ratings.length,")"]}),t.ratings.map(a=>e.jsxs("div",{className:"p-3 rounded-lg bg-black/30 border border-cyan-300/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:a.rater}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Score: ",a.total_score,"/100"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M(a),className:"p-2 bg-blue-500/30 hover:bg-blue-500/50 rounded-lg transition-colors",title:"Edit",children:e.jsx(z,{className:"w-4 h-4 text-blue-300"})}),e.jsx("button",{onClick:()=>A(a.id),className:"p-2 bg-red-500/30 hover:bg-red-500/50 rounded-lg transition-colors",title:"Delete",children:e.jsx(q,{className:"w-4 h-4 text-red-300"})})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-1 text-xs",children:u.map((r,l)=>e.jsxs("div",{className:"text-gray-400",children:[r.name,": ",e.jsx("span",{className:"text-cyan-300",children:a.ratings[l]})]},l))})]},a.id))]})]})]},s.id)})]})]})]}),e.jsx("style",{children:`
        @keyframes blink {
          0%, 50% { opacity: 1; }
          51%, 100% { opacity: 0; }
        }
        .star {
          position: absolute;
          background: white;
          border-radius: 50%;
          animation: blink 2s infinite;
        }
      `})]})}export{O as default};
